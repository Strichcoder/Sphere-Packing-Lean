\subsection{Bounds on Finite Density of Periodic Prcking}

In this subsection, we build up results about the density of periodic packings. In particular, the density of a periodic packing, defined as the limit of the periodic packing intersected with a growing ball centered at the origin, is equal to the density within any fundamental region of the period lattice. The strategy is to prove lower and upper bounds for the number of lattice points in a ball in terms of the volume of the ball, correct up to the highest order term. Taking limit gives the correct density!

Below, let $X \subseteq \R^d$ be a set of periodic packing centers with respect to the lattice $\Lambda \subset \R^d$. We write $kX \coloneqq \{kv : v \in X\}$.

\begin{definition}\label{fd}\lean{}\uses{}
  Let $\Lambda \subset \R^d$ be a lattice. A set $\mathcal{D} \subseteq \R^d$ is a \emph{fundamental domain} of $\Lambda$ such that for all distinct $x, y \in \Lambda$, we have $(x + \mathcal{D}) \cap (y + \mathcal{D}) = \emptyset$ (disjointness) and $\bigcup_{x \in \Lambda} x + \mathcal{D} = \R^d$ (tiling).
\end{definition}

\begin{lemma}\label{exists-bounded-fd}\lean{}\uses{fd}
  There always exists a \emph{bounded} fundamental region $\mathcal{D}$ of $\Lambda$.
\end{lemma}
\begin{proof}
  Since lattices have $\Z$-bases, there exists a set of vectors $\mathcal{B} \subseteq \R^d$ such that $\Lambda = \mathrm{span}_{\Z}(\mathcal{B})$. We claim that $\mathcal{D}_{\Lambda} = \{\sum_i c_i\mathcal{B}_i \subseteq \R^n : c_i \in [0, 1)^n\}$ is a fundamental domain. The rest exists in Mathlib already so I don't bother elaborating here :) From the definition, we see that for $v = \sum_i c_i\mathcal{B}_i \in \mathcal{D}_{\Lambda}$, we have $\|v\| \leq \sum_i \|c_i\mathcal{B}_i\| \leq \sum_i \|\mathcal{B}_i\|$, which is a constant. Hence, $\mathcal{D}_{\Lambda}$ is bounded.
\end{proof}

We denote by $L$ the bound of norm of vectors in the fundamental domain $\mathcal{D}$.

\begin{lemma}\label{exists-fd-coset-contains}\lean{}\uses{fd}
  For all vectors $v \in \R^d$ there exists a unique lattice point $x \in \Lambda$ such that $v \in x + \mathcal{D}$.
\end{lemma}
\begin{proof}
  By the tiling property of the fundamental domain, we have $v \in \bigcup_{x \in \Lambda} (x + \mathcal{D})$. By definition, this means there exists a lattice point $x \in \Lambda$ such that $v \in x + \mathcal{D}$. To show that it is unique, suppose that $v \in (x + \mathcal{D}) \cap (y + \mathcal{D})$ for distinct $x \neq y \in \Lambda$. By the disjointness property, $v \in \emptyset$, contradiction.
\end{proof}

\begin{proof}[Proof of \cref{lattice-points-bounds}]\label{lattice-points-bounds-proof}\uses{fd, exists-fd-coset-contains}
  For the first inequality, it suffices to prove that $\mathcal{B}_d(R - L) \subseteq \bigcup_{x \in \Lambda \cap \mathcal{B}_d(R)} (x + \mathcal{D})$, since the cosets on the right are almost disjoint. For a vector $v \in \mathcal{B}_d(R - L)$, we have $\|v\| < R - L$ by definition. By Lemma \cref{exists-fd-coset-contains}, there exists a lattice point $x \in \Lambda$ such that $v \in x + \mathcal{D}$. Rearranging gives $v - x \in \mathcal{D}$, which means $\|v - x\| \leq L$. By the triangle inequality, $\|x\| < R$, i.e. $x \in \mathcal{B}_d(L)$, concluding the proof.

  For the second inequality, we prove that $\bigcup_{x \in \Lambda \cap \mathcal{B}_d(R)} (x + \mathcal{D}) \subseteq \mathcal{B}_d(R + L)$. Consider a vector $x \in \Lambda \cap \mathcal{B}_d(R)$ and a vector $y \in x + \mathcal{D}$. From above, we know $\|x\| < R$ and $\|y - x\| \leq L$, so $\|y\| < R + L$, concluding the proof.
\end{proof}

Next, we build up to the proof for \cref{periodic-points-bounds}

\begin{definition}\label{periodic-quot-lattice-def}
  Suppose that $\Lambda$ acts (additively) on $X$. We can associate an equivalence relation $\sim$ to the action generated by $x \sim y + x$ for all $x \in X$ and $y \in \Lambda$. We define the set $X / \Lambda \coloneqq X / \sim$. \todo{Give this a name? lol}
\end{definition}

In Lean, $X / \Lambda$ is defined as the type \texttt{Quotient S.addAction.orbitRel}.

\begin{lemma}\label{periodic-quot-lattice-finite}\uses{periodic-quot-lattice-def}\lean{PeriodicSpherePacking.finiteOrbitRelQuotient}\leanok
  For $X$ a discrete set and $\Lambda$ a $\mathbb{Z}$-lattice, $X / \Lambda$ is finite.
\end{lemma}
\begin{proof}\leanok
  We first prove a bijection (as equivalence of types in Lean) between $X / \Lambda$ and $X \cap \mathcal{D}$, where $\mathcal{D}$ is any bounded fundamental region of $\Lambda$.

  Now to prove that $X \cap \mathcal{D}$ is finite, we argue by looking at the volume of $\mathcal{P}(X \cap \mathcal{D})$. Indeed, we have $\mathcal{P}(X \cap \mathcal{D}) = \bigcup_{x \in X \cap \mathcal{D}} \mathcal{B}_d\left(x, \frac{r}{2}\right) \subseteq \mathcal{B}_d\left(L + \frac{r}{2}\right)$, where $L$ is the norm bound of $\mathcal{D}$ and $r$ is the separation radius of $X$, by a straightforward application of the triangle inequality. Moreover, by definition of the separation radius, the balls in the LHS are also pairwise disjoint. Taking volumes on both sides, we have $\sum_{x \in X \cap \mathcal{D}} \mathrm{Vol}\left(\mathcal{B}_d\left(x, \frac{r}{2}\right)\right) = |X \cap \mathcal{D}|\mathrm{Vol}\left(\mathcal{B}_d\left(\frac{r}{2}\right)\right) \leq \mathrm{Vol}\left(\mathcal{B}_d\left(L + \frac{r}{2}\right)\right)$, concluding the proof.

  Note that there is a minor technicality here, as the formula $\mathrm{Vol}\left(\bigcup_{x \in S} f(x)\right) = \sum_{x \in S} \mathrm{Vol}(f(x))$ used is only true when $S = X \cap \mathcal{D}$ is countable, which is not true here \textit{a priori}. However, if $X \cap \mathcal{D}$ is uncountable, then we can simply take a countable subset of it and argue as above. Thanks to Etienne Marion on Zulip for the idea!
\end{proof}

\begin{lemma}\label{some label here}\uses{periodic-quot-lattice-finite}
  For $R > L$, \todo{Prove this shit lol}

  \[
    \bigcup_{x \in \Lambda \cap \mathcal{B}_d(R - L)} (x + \mathcal{D}) \subseteq \mathcal{B}_d(R)
  \]
\end{lemma}
\begin{proof}\uses{}
  Trivial. \todo{Fill this in}
\end{proof}

\begin{proof}[Proof of \cref{periodic-points-bounds}]\label{periodic-points-bounds-proof}\uses{some label here}
  Intersecting both sides of \ref{some label here} with $X$ and simplifying, we have

  \[
    \left(\bigcup_{x \in \Lambda \cap \mathcal{B}_d(R - L)} (x + \mathcal{D})\right) \cap X = \bigcup_{x \in \Lambda \cap \mathcal{B}_d(R - L)} ((x + \mathcal{D}) \cap X) \subseteq \mathcal{B}_d(R) \cap X
  \]

  Consider the (finite) cardinality on both sides and noting that $|(x + \mathcal{D}) \cap X| = |X / \Lambda|$ for all $x$, we see that $|\Lambda \cap \mathcal{B}_d(R - L)||X / \Lambda| \leq |X \cap \mathcal{B}_d(R)|$, as desired.

  \todo{Fill in the proof of the second inequality.}
\end{proof}
